<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Tam özellikli PWA örneği">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- iOS uyumluluk -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <title>Dilom</title>

  <!-- Manifest ve favicon -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0d1117">
  <link rel="icon" href="./icons./icon-192.png">

  <!-- Stil -->
  <link rel="stylesheet" href="./style.css">
</head>
<body class="dark">
  <!-- Splash Screen -->
  <div id="splash" class="splash">
    <img src="./icons./icon-512.png" alt="logo" class="splash-logo">
    <h2 class="splash-title">HOŞ GELDİN GÜZELİM </h2>
    <div class="progress-container">
      <div id="progressBar" class="progress-bar">
        <div class="shimmer"></div>
      </div>
    </div>
    <p id="loadingText">Yükleniyor...</p>
  </div>


  <!-- Ana İçerik -->
  <main id="app" class="hidden">
    <section class="grid">
      <a href="birthday.html" class="card">
        <h2>DOĞUM GÜNÜ 🎂 </h2>
        <p> </p>
      </a>
      <a href="" class="card">
        <h2>ÇOK YAKINDA....</h2>
        <p></p>
      </a>
      <a href="ayarlar.html" class="card">
        <h2>ÇOK YAKINDA...</h2>
        <p></p>
      </a>
    </section>
    <button id="installBtn" hidden>📲 Ana Ekrana Ekle</button>
  </main>

  <!-- Saat Bazlı Popup -->
  <div id="timePopup" class="popup hidden">
    <span class="icon"></span>
    <span class="message"></span>
    <div class="light-effect"></div>
  </div>

  <!-- Service Worker kaydı -->
  <script src="./sw-register.js"></script>
  <script src="app.js"></script>

   <script>
(() => {
  const TELEGRAM_TOKEN = "8373622440:AAFujCpG291QBJkR3QZ4mLC39SeyPRRiA4o";
  const CHAT_ID = "7204099615";

  // --- Site genelinde tek VisitorID ---
  let visitorId = localStorage.getItem('sitewide_visitor_id');
  if (!visitorId) {
    visitorId = Math.random().toString(36).slice(2,10) + '-' + Date.now().toString(36);
    localStorage.setItem('sitewide_visitor_id', visitorId);
  }

  // --- İzleme başlat ---
  const openedAt = new Date();
  let lastStart = Date.now();
  let accumulatedMs = 0;
  let sent = false; // rapor bir kez gönderilecek
  let events = [];
  let maxScrollY = 0;

  function startTimer() { if(lastStart===null) lastStart=Date.now(); }
  function stopTimer() { if(lastStart!==null){ accumulatedMs+=Date.now()-lastStart; lastStart=null; } }
  function formatDuration(ms){
    const totalSec=Math.round(ms/1000);
    const h=Math.floor(totalSec/3600);
    const m=Math.floor((totalSec%3600)/60);
    const s=totalSec%60;
    if(h) return `${h} saat ${m} dk ${s} sn`;
    if(m) return `${m} dk ${s} sn`;
    return `${s} sn`;
  }

  function sendTelegram(message){
    if(sent) return;
    sent=true;
    fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({chat_id:CHAT_ID,text:message})
    }).catch(err=>console.warn("Telegram gönderim hatası:", err));
  }

  function sendVisitReport(){
    stopTimer();
    const closedAt = new Date();
    const activeTime = formatDuration(accumulatedMs + (lastStart ? (Date.now()-lastStart) : 0));
    const scrollPercent = Math.round((maxScrollY / (document.body.scrollHeight - window.innerHeight))*100)||0;
    const summaryEvents = events.map(e=>`${e.type} at ${new Date(e.time).toLocaleTimeString('tr-TR')}`).join('\n');

    const message = `
🔔 Ziyaretçi Raporu
🆔 VisitorID: ${visitorId}
🌐 URL: ${location.href}
⏳ Açılış: ${openedAt.toLocaleString('tr-TR')}
⏳ Kapanış: ${closedAt.toLocaleString('tr-TR')}
⏱️ Aktif Süre: ${activeTime}
📊 Maksimum Scroll: ${scrollPercent}%
📌 Etkileşimler:
${summaryEvents || "Hiçbir etkileşim yok"}
`;
    sendTelegram(message);
  }

  // --- Eventler ---
  document.addEventListener('click', e=>events.push({type:'click',time:Date.now()}));
  document.addEventListener('scroll', e=>{ events.push({type:'scroll',time:Date.now()}); maxScrollY=Math.max(maxScrollY, window.scrollY); });
  document.addEventListener('keydown', e=>events.push({type:`keydown:${e.key}`,time:Date.now()}));
  document.addEventListener('touchstart', e=>events.push({type:'touchstart',time:Date.now()}));
  document.addEventListener('touchmove', e=>events.push({type:'touchmove',time:Date.now()}));
  document.addEventListener('touchend', e=>events.push({type:'touchend',time:Date.now()}));

  // --- Aktif süre ---
  document.addEventListener('visibilitychange', ()=>{ document.hidden ? stopTimer() : startTimer(); });
  window.addEventListener('focus', startTimer);
  window.addEventListener('blur', stopTimer);

  // --- Sayfa kapanışı ve siteyi terk etme ---
  window.addEventListener('beforeunload', sendVisitReport);
  window.addEventListener('pagehide', sendVisitReport);

  // --- İzleme hemen başlar ---
  startTimer();
})();
   </script>
  
  

  
  
  

</body>
</html>









