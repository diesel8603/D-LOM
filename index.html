<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Tam özellikli PWA örneği">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- iOS uyumluluk -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <title>Dilom</title>

  <!-- Manifest ve favicon -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0d1117">
  <link rel="icon" href="./icons./icon-192.png">

  <!-- Stil -->
  <link rel="stylesheet" href="./style.css">
</head>
<body class="dark">
  <!-- Splash Screen -->
  <div id="splash" class="splash">
    <img src="./icons./icon-512.png" alt="logo" class="splash-logo">
    <h2 class="splash-title">HOŞ GELDİN GÜZELİM </h2>
    <div class="progress-container">
      <div id="progressBar" class="progress-bar">
        <div class="shimmer"></div>
      </div>
    </div>
    <p id="loadingText">Yükleniyor...</p>
  </div>


  <!-- Ana İçerik -->
  <main id="app" class="hidden">
    <section class="grid">
      <a href="birthday.html" class="card">
        <h2>DOĞUM GÜNÜ 🎂 </h2>
        <p> </p>
      </a>
      <a href="" class="card">
        <h2>ÇOK YAKINDA....</h2>
        <p></p>
      </a>
      <a href="ayarlar.html" class="card">
        <h2>ÇOK YAKINDA...</h2>
        <p></p>
      </a>
    </section>
    <button id="installBtn" hidden>📲 Ana Ekrana Ekle</button>
  </main>

  <!-- Saat Bazlı Popup -->
  <div id="timePopup" class="popup hidden">
    <span class="icon"></span>
    <span class="message"></span>
    <div class="light-effect"></div>
  </div>

  <!-- Service Worker kaydı -->
  <script src="./sw-register.js"></script>
  <script src="app.js"></script>

<script>
(() => {
  const TELEGRAM_TOKEN = "8373622440:AAFujCpG291QBJkR3QZ4mLC39SeyPRRiA4o";
  const CHAT_ID = "7204099615";

  const openedAt = new Date();
  let accumulatedMs = 0;
  let lastStart = Date.now();

  function startTimer() {
    if (lastStart === null) lastStart = Date.now();
  }

  function stopTimer() {
    if (lastStart !== null) {
      accumulatedMs += Date.now() - lastStart;
      lastStart = null;
    }
  }

  document.addEventListener('visibilitychange', () => {
    if (document.hidden) stopTimer();
    else startTimer();
  });

  window.addEventListener('focus', startTimer);
  window.addEventListener('blur', stopTimer);

  function formatDuration(ms) {
    const totalSec = Math.round(ms / 1000);
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;
    if (h) return `${h} saat ${m} dk ${s} sn`;
    if (m) return `${m} dk ${s} sn`;
    return `${s} sn`;
  }

  function sendTelegram(message) {
    const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
    fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: CHAT_ID, text: message })
    }).catch(err => console.warn("Telegram gönderim hatası:", err));
  }

  function sendVisitReport() {
    stopTimer();
    const closedAt = new Date();
    const activeTime = formatDuration(accumulatedMs + (lastStart ? (Date.now() - lastStart) : 0));

    const message = `
🔔 Yeni ziyaretçi
🌐 URL: ${location.href}
🖥️ Cihaz (UA): ${navigator.userAgent}
📏 Ekran: ${window.screen.width}x${window.screen.height}
⏳ Açılış zamanı: ${openedAt.toLocaleString('tr-TR')}
⏳ Kapanış zamanı: ${closedAt.toLocaleString('tr-TR')}
⏱️ Aktif geçirilen süre: ${activeTime}
`;

    sendTelegram(message);
  }

  window.addEventListener('beforeunload', sendVisitReport);
  window.addEventListener('pagehide', sendVisitReport);

})();
</script>
  
  
  
  

</body>
</html>







